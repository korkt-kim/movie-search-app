{"ast":null,"code":"var _jsxFileName = \"/Users/gyul/git/movie-search-app/src/components/searchResults/index.tsx\",\n    _s2 = $RefreshSig$();\n\nimport { useEffect, useCallback, useMemo, useRef } from 'react';\nimport { useRecoilState, useRecoilValue, useResetRecoilState } from 'recoil';\nimport { usePrevious } from 'react-use';\nimport { keywordState, pageState, searchResultState, totalCountState } from 'states/atom';\nimport { getMovieSearchApi } from 'services/movie';\nimport SearchResultMovie from '../searchResultMovie';\nimport styles from './searchResults.module.scss';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst SearchResults = () => {\n  _s2();\n\n  var _s = $RefreshSig$();\n\n  const keyword = useRecoilValue(keywordState);\n  const [page, setPage] = useRecoilState(pageState);\n  const [totalCount, setTotalCount] = useRecoilState(totalCountState);\n  const [, setMovies] = useRecoilState(searchResultState);\n  const resetMovies = useResetRecoilState(searchResultState);\n  const firstRender = useFirstRender();\n  const lastPage = useMemo(() => Math.ceil(totalCount / 10), [totalCount]);\n  const prevKeyword = usePrevious(keyword);\n  const prevPage = usePrevious(page);\n  const msgRef = useRef(null);\n\n  function useFirstRender() {\n    _s();\n\n    const firstRender = useRef(true);\n    useEffect(() => {\n      firstRender.current = false;\n    }, []);\n    return firstRender.current;\n  }\n\n  _s(useFirstRender, \"ATSdOeWIj8DnzpAvwLTk08ZcQSw=\");\n\n  useEffect(() => {\n    if (firstRender) return;\n    if (keyword === prevKeyword && page === prevPage) return;\n\n    const getSearchResult = async () => {\n      const response = await getMovieSearchApi({\n        s: keyword,\n        page\n      });\n      const {\n        Search,\n        totalResults\n      } = response.data;\n\n      if (!Search || !totalResults) {\n        resetMovies();\n        return;\n      }\n\n      setMovies(prev => [...prev, ...Search]);\n      setTotalCount(Number(totalResults));\n    };\n\n    getSearchResult();\n  }, [keyword, page, setMovies, resetMovies, setTotalCount, firstRender, prevKeyword, prevPage]);\n  const handleScrollEvent = useCallback(e => {\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight\n    } = e.currentTarget;\n    const checkPage = lastPage <= page;\n    const isEnd = scrollHeight <= Math.ceil(scrollTop + clientHeight);\n\n    if (isEnd) {\n      if (checkPage && msgRef.current) {\n        msgRef.current.style.display = 'block';\n        return;\n      }\n\n      setPage(prev => prev + 1);\n    }\n  }, [lastPage, page, setPage]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: styles.searchResultsWrapper,\n    children: [totalCount < 1 ? /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"\\uAC80\\uC0C9 \\uACB0\\uACFC\\uAC00 \\uC5C6\\uC2B5\\uB2C8\\uB2E4 \\uD83D\\uDE25\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 25\n    }, this) : /*#__PURE__*/_jsxDEV(\"h1\", {\n      children: [\"\\uAC80\\uC0C9 \\uACB0\\uACFC \", totalCount, \" \\uAC1C\\uAC00 \\uBC1C\\uACAC\\uB410\\uC2B5\\uB2C8\\uB2E4\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 51\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      onScroll: handleScrollEvent,\n      children: [/*#__PURE__*/_jsxDEV(SearchResultMovie, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h1\", {\n        className: styles.endMsg,\n        ref: msgRef,\n        children: \"\\uB9C8\\uC9C0\\uB9C9 \\uAC80\\uC0C9 \\uACB0\\uACFC\\uC785\\uB2C8\\uB2E4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n};\n\n_s2(SearchResults, \"88E9jqcxphuIWvz4K5ygfV2A7yk=\", true, function () {\n  return [useRecoilValue, useRecoilState, useRecoilState, useRecoilState, useResetRecoilState, usePrevious, usePrevious];\n});\n\n_c = SearchResults;\nexport default SearchResults;\n\nvar _c;\n\n$RefreshReg$(_c, \"SearchResults\");","map":{"version":3,"names":["useEffect","useCallback","useMemo","useRef","useRecoilState","useRecoilValue","useResetRecoilState","usePrevious","keywordState","pageState","searchResultState","totalCountState","getMovieSearchApi","SearchResultMovie","styles","SearchResults","keyword","page","setPage","totalCount","setTotalCount","setMovies","resetMovies","firstRender","useFirstRender","lastPage","Math","ceil","prevKeyword","prevPage","msgRef","current","getSearchResult","response","s","Search","totalResults","data","prev","Number","handleScrollEvent","e","scrollTop","scrollHeight","clientHeight","currentTarget","checkPage","isEnd","style","display","searchResultsWrapper","endMsg"],"sources":["/Users/gyul/git/movie-search-app/src/components/searchResults/index.tsx"],"sourcesContent":["import { useEffect, useCallback, useMemo, useRef } from 'react'\nimport { useRecoilState, useRecoilValue, useResetRecoilState } from 'recoil'\nimport { usePrevious } from 'react-use'\n\nimport { keywordState, pageState, searchResultState, totalCountState } from 'states/atom'\nimport { getMovieSearchApi } from 'services/movie'\n\nimport SearchResultMovie from '../searchResultMovie'\nimport styles from './searchResults.module.scss'\n\nconst SearchResults = () => {\n  const keyword = useRecoilValue(keywordState)\n  const [page, setPage] = useRecoilState(pageState)\n  const [totalCount, setTotalCount] = useRecoilState(totalCountState)\n  const [, setMovies] = useRecoilState(searchResultState)\n  const resetMovies = useResetRecoilState(searchResultState)\n\n  const firstRender = useFirstRender()\n  const lastPage = useMemo(() => Math.ceil(totalCount / 10), [totalCount])\n  const prevKeyword = usePrevious(keyword)\n  const prevPage = usePrevious(page)\n  const msgRef = useRef<HTMLParagraphElement>(null)\n\n  function useFirstRender(): boolean {\n    const firstRender = useRef(true)\n\n    useEffect(() => {\n      firstRender.current = false\n    }, [])\n\n    return firstRender.current\n  }\n\n  useEffect(() => {\n    if (firstRender) return\n    if (keyword === prevKeyword && page === prevPage) return\n\n    const getSearchResult = async () => {\n      const response = await getMovieSearchApi({\n        s: keyword,\n        page,\n      })\n\n      const { Search, totalResults } = response.data\n\n      if (!Search || !totalResults) {\n        resetMovies()\n        return\n      }\n\n      setMovies((prev) => [...prev, ...Search])\n      setTotalCount(Number(totalResults))\n    }\n\n    getSearchResult()\n  }, [keyword, page, setMovies, resetMovies, setTotalCount, firstRender, prevKeyword, prevPage])\n\n  const handleScrollEvent = useCallback(\n    (e: React.UIEvent<HTMLUListElement>) => {\n      const { scrollTop, scrollHeight, clientHeight } = e.currentTarget\n      const checkPage = lastPage <= page\n      const isEnd = scrollHeight <= Math.ceil(scrollTop + clientHeight)\n\n      if (isEnd) {\n        if (checkPage && msgRef.current) {\n          msgRef.current.style.display = 'block'\n          return\n        }\n        setPage((prev) => prev + 1)\n      }\n    },\n    [lastPage, page, setPage]\n  )\n\n  return (\n    <div className={styles.searchResultsWrapper}>\n      {totalCount < 1 ? <h1>Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§ üò•</h1> : <h1>Í≤ÄÏÉâ Í≤∞Í≥º {totalCount} Í∞úÍ∞Ä Î∞úÍ≤¨ÎêêÏäµÎãàÎã§</h1>}\n\n      <ul onScroll={handleScrollEvent}>\n        <SearchResultMovie />\n\n        <h1 className={styles.endMsg} ref={msgRef}>\n          ÎßàÏßÄÎßâ Í≤ÄÏÉâ Í≤∞Í≥ºÏûÖÎãàÎã§\n        </h1>\n      </ul>\n    </div>\n  )\n}\n\nexport default SearchResults\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}